"""
Завдання: Django ORM - Банківська система

У вас є готові моделі. Напишіть ORM запити для отримання необхідних даних.

"""
from django.db import models
from django.contrib.auth.models import User

class Customer(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    is_vip = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)

class Account(models.Model):
    account_number = models.CharField(max_length=20, unique=True)
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE, related_name='accounts')
    account_type = models.CharField(max_length=10, choices=[('savings', 'Savings'), ('checking', 'Checking')])
    balance = models.DecimalField(max_digits=12, decimal_places=2, default=0)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)

class Transaction(models.Model):
    account = models.ForeignKey(Account, on_delete=models.CASCADE, related_name='transactions')
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    transaction_type = models.CharField(max_length=10)
    created_at = models.DateTimeField(auto_now_add=True)


# Завдання 1: Базові запити
def task_1_basic():
    """
    Отримати:
    1. Всі активні рахунки (is_active=True)
    2. Всіх VIP клієнтів  
    3. Рахунки з балансом більше 10000
    4. Ощадні рахунки (savings) VIP клієнтів
    """
    
    # 1. Активні рахунки
    active_accounts = # ваш код
    
    # 2. VIP клієнти
    vip_customers = # ваш код
    
    # 3. Рахунки з великим балансом
    rich_accounts = # ваш код
    
    # 4. Ощадні рахунки VIP клієнтів
    vip_savings = # ваш код
    
    return active_accounts, vip_customers, rich_accounts, vip_savings


# Завдання 2: Агрегація
def task_2_aggregation():
    """
    Порахувати:
    1. Загальну суму балансів всіх рахунків
    2. Кількість транзакцій для кожного рахунку (annotate)
    3. Середній баланс для кожного типу рахунку
    """
    from django.db.models import Sum, Count, Avg
    
    # 1. Сума всіх балансів
    total_balance = # ваш код
    
    # 2. Рахунки з кількістю транзакцій
    accounts_with_count = # ваш код
    
    # 3. Середній баланс по типах
    avg_by_type = # ваш код
    
    return total_balance, accounts_with_count, avg_by_type


# Завдання 3: Складніші запити
def task_3_complex():
    """
    Знайти:
    1. Клієнтів, які мають 2 або більше рахунків
    2. Топ-3 клієнти за сумарним балансом всіх їх рахунків
    3. Рахунки без жодної транзакції
    """
    from django.db.models import Sum, Count
    
    # 1. Клієнти з багатьма рахунками
    customers_multiple_accounts = # ваш код
    
    # 2. Топ-3 найбагатші клієнти  
    top_customers = # ваш код
    
    # 3. Рахунки без транзакцій
    accounts_no_transactions = # ваш код
    
    return customers_multiple_accounts, top_customers, accounts_no_transactions